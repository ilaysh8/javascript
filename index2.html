<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Space Game ðŸš€</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {margin:0; padding:0; width:100%; height:100%; overflow:hidden; font-family:Arial, sans-serif;}
canvas {display:block; background:black;}
.overlay {position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); color:white; text-align:center; padding:20px; overflow-y:auto; display:none;}
.option {width:60px; height:60px; margin:5px; display:inline-block; border:3px solid white; cursor:pointer; border-radius:10px; transition:0.2s;}
.option:hover {transform: scale(1.1); border-color:yellow;}
button {margin:5px; padding:10px 20px; font-size:16px; cursor:pointer; border-radius:10px; font-weight:bold;}
#scoreBoard {position:absolute; top:10px; left:10px; color:white; font-size:24px; z-index:1000;}
#levelBoard {position:absolute; top:10px; right:10px; color:white; font-size:24px; z-index:1000;}
#buttons {position:absolute; top:10px; left:50%; transform:translateX(-50%); z-index:1000;}
#startBtn {position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); padding:20px 40px; font-size:32px; background:lime; border:none; border-radius:15px; cursor:pointer; z-index:2000;}
#gameOver {display:none; position:absolute; top:0; left:0; width:100%; height:100%; z-index:1000;}
#gameOverBox {width:400px; padding:40px; background:rgba(0,0,0,0.85); color:red; font-size:50px; text-align:center; border:5px solid yellow; border-radius:20px; box-shadow:0 0 20px red; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);}
#gameOverBox button {padding:15px 30px; font-size:24px; background:lime; border:none; border-radius:15px; cursor:pointer;}

/* ðŸŽ® Joystick */
#joystick {
  position: fixed;
  bottom: 40px;
  left: 40px;
  width: 120px;
  height: 120px;
  background: rgba(255,255,255,0.1);
  border: 2px solid rgba(0,255,255,0.3);
  border-radius: 50%;
  z-index: 2000;
  touch-action: none;
  display: none;
}
#stick {
  position: absolute;
  width: 50px;
  height: 50px;
  left: 35px;
  top: 35px;
  background: rgba(0,255,255,0.6);
  border-radius: 50%;
}
@media (max-width: 820px) {
  #joystick { display: block; }
}
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="scoreBoard">Score: 0</div>
<div id="levelBoard">Level: 1</div>

<div id="buttons">
  <button id="shopBtn" style="background:yellow;">SHOP</button>
  <button id="pauseBtn" style="background:orange;">PAUSE</button>
  <button id="restartBtn" style="background:red;">RESTART</button>
  <button id="shapeBtn" style="background:lightblue;">SHAPE</button>
  <button id="bgBtn" style="background:lightgreen;">BACKGROUND</button>
  <button id="speedBtn" style="background:violet;">SPEED</button>
</div>

<button id="startBtn">START</button>

<!-- ðŸŽ® Joystick -->
<div id="joystick">
  <div id="stick"></div>
</div>

<div id="shopPage" class="overlay">
  <h1>ðŸŽ¨ Choose color (50 points)</h1>
  <div id="colors"></div>
  <p id="shopMsg"></p>
  <button id="closeShop">Close</button>
</div>

<div id="shapePage" class="overlay">
  <h1>ðŸ›¸ Choose shape (100 points)</h1>
  <div id="shapes"></div>
  <p id="shapeMsg"></p>
  <button id="closeShape">Close</button>
</div>

<div id="bgPage" class="overlay">
  <h1>ðŸŒŒ Choose background</h1>
  <div id="bgs"></div>
  <p id="bgMsg"></p>
  <button id="closeBG">Close</button>
</div>

<div id="speedPage" class="overlay">
  <h1>âš¡ Choose speed (1-10)</h1>
  <div id="speeds"></div>
  <p id="speedMsg"></p>
  <button id="closeSpeed">Close</button>
</div>

<div id="gameOver">
  <div id="gameOverBox">
    GAME OVER
    <br><br>
    <button id="restartFromOver">RESTART</button>
  </div>
</div>

<script>
// === Canvas ===
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

// === Game Variables ===
let score=parseInt(localStorage.getItem('score'))||0;
let level=parseInt(localStorage.getItem('level'))||1;
let paused=false, started=false;
let player={
  x:canvas.width/2-30, y:canvas.height-100, width:60, height:60,
  color:localStorage.getItem('playerColor')||'cyan',
  shape:localStorage.getItem('playerShape')||'square',
  speed:parseInt(localStorage.getItem('playerSpeed'))||5
};
let bullets=[], enemies=[], explosions=[];
let shootDelay=500, lastShootTime=0;
let enemySpawnRate=2000, lastEnemySpawn=0;

// === Stars Background ===
let stars=[];
for(let i=0;i<200;i++) stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*2+1,speed:Math.random()*0.2+0.05});

// === Music ===
const songs=[{url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',bpm:90},{url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',bpm:120}];
let currentSongIndex=0;
const audio=new Audio(); audio.loop=true;

// === Keyboard ===
let keys={};
document.addEventListener("keydown",e=>{keys[e.code]=true;if(e.code==='Space'){shoot();e.preventDefault();}});
document.addEventListener("keyup",e=>keys[e.code]=false);

// === Shooting ===
function shoot(){
  const now=Date.now();
  if(now-lastShootTime>shootDelay){
    bullets.push({x:player.x+player.width/2-5,y:player.y,width:10,height:20});
    lastShootTime=now;
  }
}

// === Enemies ===
function spawnEnemy(){ enemies.push({x:Math.random()*(canvas.width-50),y:-60,width:50,height:50,speed:1+Math.random()*level});}

// === Update ===
function update(){
  if(paused||!started)return;

  // Movement via keyboard or joystick
  player.x+=moveX;
  if(keys["ArrowLeft"]&&player.x>0)player.x-=player.speed;
  if(keys["ArrowRight"]&&player.x<canvas.width-player.width)player.x+=player.speed;
  player.x=Math.max(0,Math.min(canvas.width-player.width,player.x));

  bullets.forEach(b=>b.y-=8);
  bullets=bullets.filter(b=>b.y>0);
  enemies.forEach(e=>e.y+=e.speed);
  enemies=enemies.filter(e=>e.y<canvas.height);

  bullets.forEach((b,bi)=>{
    enemies.forEach((e,ei)=>{
      if(b.x<e.x+e.width&&b.x+b.width>e.x&&b.y<e.y+e.height&&b.y+b.height>e.y){
        explosions.push({x:e.x,y:e.y,r:10,maxR:40});
        enemies.splice(ei,1);
        bullets.splice(bi,1);
        score+=3;
      }
    });
  });

  explosions.forEach(ex=>ex.r+=2);
  explosions=explosions.filter(ex=>ex.r<ex.maxR);

  stars.forEach(s=>{s.y+=s.speed;if(s.y>canvas.height)s.y=0;});

  const now=Date.now();
  if(now-lastEnemySpawn>enemySpawnRate){spawnEnemy();lastEnemySpawn=now;}

  document.getElementById('scoreBoard').innerText='Score: '+score;
  document.getElementById('levelBoard').innerText='Level: '+level;

  if(enemies.some(e=>e.y+e.height>=canvas.height)){
    document.getElementById('gameOver').style.display='block';
    paused=true; audio.pause();
    localStorage.setItem('score',score);
    localStorage.setItem('playerColor',player.color);
    localStorage.setItem('playerShape',player.shape);
    localStorage.setItem('playerSpeed',player.speed);
  }
}

// === Draw Player ===
const shapes=['square','circle','triangle','diamond','trapezoid','star'];
function drawPlayer(){
  ctx.fillStyle=player.color;
  if(player.shape==='square'){ctx.fillRect(player.x,player.y,player.width,player.height);}
  else if(player.shape==='circle'){ctx.beginPath();ctx.arc(player.x+player.width/2,player.y+player.height/2,player.width/2,0,Math.PI*2);ctx.fill();}
  else if(player.shape==='triangle'){ctx.beginPath();ctx.moveTo(player.x+player.width/2,player.y);ctx.lineTo(player.x,player.y+player.height);ctx.lineTo(player.x+player.width,player.y+player.height);ctx.closePath();ctx.fill();}
  else if(player.shape==='diamond'){ctx.beginPath();ctx.moveTo(player.x+player.width/2,player.y);ctx.lineTo(player.x+player.width,player.y+player.height/2);ctx.lineTo(player.x+player.width/2,player.y+player.height);ctx.lineTo(player.x,player.y+player.height/2);ctx.closePath();ctx.fill();}
  else if(player.shape==='trapezoid'){ctx.beginPath();ctx.moveTo(player.x,player.y);ctx.lineTo(player.x+player.width/4,player.y+player.height);ctx.lineTo(player.x+player.width*3/4,player.y+player.height);ctx.lineTo(player.x+player.width,player.y);ctx.closePath();ctx.fill();}
  else if(player.shape==='star'){ctx.beginPath();let cx=player.x+player.width/2,cy=player.y+player.height/2,spikes=5,outer=player.width/2,inner=player.width/4,rot=Math.PI/2*3,x=cx,y=cy,step=Math.PI/spikes;ctx.moveTo(cx,cy-outer);for(let i=0;i<spikes;i++){x=cx+Math.cos(rot)*outer;y=cy+Math.sin(rot)*outer;ctx.lineTo(x,y);rot+=step;x=cx+Math.cos(rot)*inner;y=cy+Math.sin(rot)*inner;ctx.lineTo(x,y);rot+=step;}ctx.closePath();ctx.fill();}
}

// === Draw ===
function draw(){
  ctx.fillStyle='black'; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='white'; stars.forEach(s=>{ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();});
  drawPlayer();
  ctx.fillStyle='red'; bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.width,b.height));
  ctx.fillStyle='lime'; enemies.forEach(e=>ctx.fillRect(e.x,e.y,e.width,e.height));
  ctx.fillStyle='orange'; explosions.forEach(ex=>{ctx.beginPath();ctx.arc(ex.x+25,ex.y+25,ex.r,0,Math.PI*2);ctx.fill();});
  ctx.fillStyle='white'; ctx.font='16px Arial'; ctx.fillText('MADE BY ILAYS',10,canvas.height-10);
}

// === Loop ===
function gameLoop(){update();draw();requestAnimationFrame(gameLoop);} gameLoop();

// === Buttons ===
document.getElementById('pauseBtn').onclick=()=>{paused=!paused;if(paused){audio.pause();document.getElementById('pauseBtn').textContent='RESUME';}else{audio.play();document.getElementById('pauseBtn').textContent='PAUSE';}};
document.getElementById('restartBtn').onclick=()=>{score=0;bullets=[];enemies=[];explosions=[];paused=false;document.getElementById('gameOver').style.display='none';audio.play();};
document.getElementById('startBtn').onclick=()=>{started=true;paused=false;audio.src=songs[currentSongIndex].url;audio.playbackRate=songs[currentSongIndex].bpm/120;audio.play();document.getElementById('startBtn').style.display='none';};
document.getElementById('restartFromOver').onclick=()=>{bullets=[];enemies=[];explosions=[];paused=false;document.getElementById('gameOver').style.display='none';audio.play();};

// === Joystick ===
const joystick=document.getElementById('joystick');
const stick=document.getElementById('stick');
let touchId=null, moveX=0;

joystick.addEventListener('touchstart',e=>{
  touchId=e.changedTouches[0].identifier;
});
joystick.addEventListener('touchmove',e=>{
  for(const t of e.changedTouches){
    if(t.identifier===touchId){
      const rect=joystick.getBoundingClientRect();
      const x=t.clientX-rect.left-rect.width/2;
      const maxDist=rect.width/2-25;
      const clampedX=Math.max(-maxDist,Math.min(maxDist,x));
      stick.style.left=35+clampedX+'px';
      moveX=(clampedX/maxDist)*player.speed;
    }
  }
});
joystick.addEventListener('touchend',()=>{
  stick.style.left='35px';
  moveX=0;
});
</script>
</body>
</html>
