<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Space Tic Tac Toe</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
<style>
body {
    margin: 0;
    font-family: 'Orbitron', sans-serif;
    background: url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?fit=crop&w=1950&q=80') no-repeat center center fixed;
    background-size: cover;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
}

/* --- start menu --- */
#startMenu {
    position: fixed;
    inset: 0;
    background: rgba(0,0,30,0.95);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}
#startMenu h1 {
    font-size: 48px;
    margin-bottom: 20px;
    color: #0ff;
    text-shadow: 0 0 15px #0ff;
}
#startMenu input {
    padding: 10px;
    font-size: 24px;
    margin: 5px;
    border-radius: 5px;
    border: none;
    text-align: center;
}
button {
    padding: 22px 55px;
    margin: 10px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    background: #00ffff;
    color: #000;
    font-weight: bold;
    font-size: 26px;
    transition: transform 0.2s, background 0.2s;
}
button:hover {
    background: #00cccc;
    transform: scale(1.05);
}

/* --- main game container --- */
#gameContainer {
    position: relative;
    background: rgba(0,0,20,0.85);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 0 30px #00ffff, 0 0 60px #00ffff inset;
}

/* --- board --- */
#game {
    display: grid;
    grid-template-columns: repeat(3, 150px);
    grid-template-rows: repeat(3, 150px);
    gap: 10px;
    margin-top: 20px;
}

.cell {
    font-size: 100px;
    border-radius: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    background: rgba(0,0,50,0.6);
    box-shadow: 0 0 10px #00ffff;
    transition: transform 0.3s, background 0.3s, color 0.3s;
}
.cell:hover {
    transform: scale(1.05);
    background: rgba(0,0,80,0.8);
    box-shadow: 0 0 20px #00ffff;
}

#status { margin-top: 10px; font-size: 28px; text-shadow: 0 0 10px #00ffff; }
#turnIndicator { margin-top: 5px; font-size: 22px; font-weight: bold; text-shadow: 0 0 5px #ff0; }

/* --- shop --- */
#shopContainer {
    display: none;
    flex-wrap: wrap;
    justify-content: center;
    max-width: 90vw;
    margin-top: 10px;
    position: absolute;
    top: 10px;
    overflow-y: auto;
    max-height: 80vh;
    background: rgba(0,0,20,0.9);
    border-radius: 20px;
    padding: 15px;
    z-index: 999;
}
.shopItem {
    background: rgba(0,0,60,0.7);
    padding: 15px;
    margin: 5px;
    border-radius: 15px;
    width: 180px;
    text-align: center;
    box-shadow: 0 0 15px #00ffff;
    transition: transform 0.3s, box-shadow 0.3s;
}
.shopItem:hover {
    transform: scale(1.05);
    box-shadow: 0 0 25px #ff00ff;
}
.closeShopX {
    position: absolute;
    top: 5px;
    right: 5px;
    font-size: 22px;
    background: transparent;
    color: #ff00ff;
    border: none;
    cursor: pointer;
}

/* --- confetti --- */
.confetti {
    position: fixed;
    width: 8px;
    height: 8px;
    top: 0; /* מתחיל מלמעלה */
    z-index: 9999;
    pointer-events: none;
    animation: fall 3s linear forwards;
    border-radius: 3px;
}
@keyframes fall {
    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

/* --- level menu --- */
#levelMenu {
    display: none;
    position: absolute;
    top: 15%;
    background: rgba(0,0,40,0.9);
    border-radius: 15px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 0 30px #00ffff;
    z-index: 1000;
}
#levelMenu select {
    padding: 10px;
    font-size: 20px;
    border-radius: 8px;
    border: none;
    background: #00ffff;
    color: #000;
    font-weight: bold;
}
</style>
</head>
<body>

<audio id="confettiSound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>

<div id="startMenu">
    <h1>Space Tic Tac Toe</h1>
    <input type="text" id="player1Name" placeholder="Your Name">
    <button onclick="startGameWithName()">Start Game</button>
    <button onclick="openShop()">Shop</button>
</div>

<div id="gameContainer" style="display:none">
    <div style="display:flex; gap:10px;">
        <button onclick="openShop()">Shop</button>
        <button onclick="toggleLevelMenu()">⚙️ Levels</button>
        <button onclick="startGame()">Restart</button>
    </div>

    <div id="game"></div>
    <h2 id="status"></h2>
    <div id="turnIndicator"></div>
    <h3>Wins: <span id="wins">0</span></h3>
</div>

<!-- level menu -->
<div id="levelMenu">
    <h2>Select Bot Level</h2>
    <select id="level">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5" selected>5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
    </select><br><br>
    <button onclick="applyLevel()">Apply</button>
</div>

<!-- shop -->
<div id="shopContainer">
    <button class="closeShopX" onclick="closeShop()">✖</button>
</div>

<script>
let board = Array(9).fill('');
let turn = 'X';
let mode = 'bot';
let gameOver = false;
let canClick = true;
let winsCount = 0;
let xColor = 'white';
let oColor = 'white';
let player1 = '';
let player2 = 'BOT';
let botLevel = 5;

const shopItems = [
    {name:'Light Green Background', cost:10, effect:()=>document.body.style.background='linear-gradient(to right,#00ff99,#66ffcc)'},
    {name:'Dark Blue Background', cost:10, effect:()=>document.body.style.background='linear-gradient(to right,#001f4d,#003366)'},
    {name:'Pink Background', cost:10, effect:()=>document.body.style.background='linear-gradient(to right,#ff99cc,#ff66ff)'},
    {name:'Blue Board', cost:15, effect:()=>document.getElementById('gameContainer').style.background='rgba(0,0,50,0.85)'},
    {name:'Pink Board', cost:15, effect:()=>document.getElementById('gameContainer').style.background='rgba(255,0,255,0.7)'},
    {name:'Red X', cost:15, effect:()=>xColor='red'},
    {name:'Lime O', cost:15, effect:()=>oColor='lime'},
    {name:'Glow Effect', cost:15, effect:()=>document.getElementById('gameContainer').style.boxShadow='0 0 50px #00ffff inset,0 0 100px #ff00ff'},
    {name:'Hover Animation', cost:15, effect:()=>{document.querySelectorAll('.cell').forEach(c=>{c.onmouseenter=()=>c.style.transform='scale(1.3) rotate(10deg)';c.onmouseleave=()=>c.style.transform='scale(1)';});}}
];

function startGameWithName(){
    player1 = document.getElementById('player1Name').value || 'Player X';
    document.getElementById('startMenu').style.display='none';
    document.getElementById('gameContainer').style.display='flex';
    startGame();
}

function startGame(){
    board = Array(9).fill('');
    turn='X';
    gameOver=false;
    canClick=true;
    document.getElementById('status').innerText='';
    renderBoard();
    updateTurnIndicator();
}

function renderBoard(){
    const gameDiv = document.getElementById('game');
    gameDiv.innerHTML='';
    board.forEach((cell,i)=>{
        const div=document.createElement('div');
        div.classList.add('cell');
        div.innerText=cell;
        div.style.color = cell==='X'?xColor:cell==='O'?oColor:'white';
        div.onclick=()=>makeMove(i);
        gameDiv.appendChild(div);
    });
}

function makeMove(index){
    if(board[index]==='' && !gameOver && canClick){
        board[index]=turn;
        renderBoard();
        if(checkWin(turn)){
            document.getElementById('status').innerText = turn==='X'?`${player1} Wins!`:`${player2} Wins!`;
            celebrate();
            gameOver=true;
            if(turn==='X') winsCount++;
            document.getElementById('wins').innerText=winsCount;
            return;
        }
        if(!board.includes('')){
            document.getElementById('status').innerText='Draw!';
            gameOver=true;
            return;
        }
        turn = turn==='X'?'O':'X';
        updateTurnIndicator();
        if(mode==='bot' && turn==='O'){
            canClick=false;
            setTimeout(()=>{ botMove(); canClick=true; updateTurnIndicator(); },700);
        }
    }
}

function updateTurnIndicator(){
    document.getElementById('turnIndicator').innerText = gameOver?'':`Turn: ${turn==='X'?player1:player2}`;
}

function botMove(){
    if(gameOver) return;
    const empty = board.map((v,i)=>v===''?i:null).filter(v=>v!==null);
    const winLines=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    let move=null;

    const roll = Math.random()*10; // 0-10
    if(roll < botLevel){ // רמה גבוהה = יותר חכם
        // נסה לנצח
        for(const line of winLines){
            const [a,b,c]=line;
            if(board[a]==='O'&&board[b]==='O'&&board[c]===''){move=c;break;}
            if(board[a]==='O'&&board[c]==='O'&&board[b]===''){move=b;break;}
            if(board[b]==='O'&&board[c]==='O'&&board[a]===''){move=a;break;}
        }
        // אם לא מצא לנצח, נסה לחסום X
        if(!move){
            for(const line of winLines){
                const [a,b,c]=line;
                if(board[a]==='X'&&board[b]==='X'&&board[c]===''){move=c;break;}
                if(board[a]==='X'&&board[c]==='X'&&board[b]===''){move=b;break;}
                if(board[b]==='X'&&board[c]==='X'&&board[a]===''){move=a;break;}
            }
        }
    }
    // אם לא מצא כלום או רמה נמוכה - מהלך רנדומלי
    if(!move) move = empty[Math.floor(Math.random()*empty.length)];

    board[move]='O';
    renderBoard();
    if(checkWin('O')){
        document.getElementById('status').innerText = `${player2} Wins!`;
        celebrate();
        gameOver=true;
        return;
    }
    turn='X';
}

function checkWin(p){
    const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    return wins.some(line=>line.every(i=>board[i]===p));
}

function celebrate(){
    const colors = ['#ff0','#ff0000','#00ff00','#0000ff','#00ffff','#ff00ff','#ffa500'];
    const audio = document.getElementById('confettiSound');
    audio.currentTime=0;
    audio.play();
    for(let i=0;i<100;i++){
        const confetti=document.createElement('div');
        confetti.classList.add('confetti');
        confetti.style.background=colors[Math.floor(Math.random()*colors.length)];
        confetti.style.left=Math.random()*100+'vw';
        confetti.style.width=confetti.style.height=Math.random()*6+6+'px';
        confetti.style.borderRadius=Math.random()*50+'%';
        document.body.appendChild(confetti);
        setTimeout(()=>confetti.remove(),3000);
    }
}

// shop
function openShop(){
    const shopDiv=document.getElementById('shopContainer');
    shopDiv.style.display='flex';
    shopDiv.innerHTML='<button class="closeShopX" onclick="closeShop()">✖</button>';
    shopItems.forEach((item,i)=>{
        const div=document.createElement('div');
        div.classList.add('shopItem');
        div.innerHTML=`<b>${item.name}</b><br>Cost: ${item.cost}<br><button onclick="buyItem(${i})">Buy</button>`;
        shopDiv.appendChild(div);
    });
}
function closeShop(){ document.getElementById('shopContainer').style.display='none'; }
function buyItem(i){
    if(winsCount>=shopItems[i].cost){
        winsCount-=shopItems[i].cost;
        document.getElementById('wins').innerText=winsCount;
        shopItems[i].effect();
        alert(`You bought ${shopItems[i].name}!`);
    } else alert('Not enough wins!');
}

// level menu
function toggleLevelMenu(){
    const menu=document.getElementById('levelMenu');
    menu.style.display = menu.style.display==='none'?'block':'none';
}
function applyLevel(){
    const lvl=parseInt(document.getElementById('level').value);
    botLevel=lvl;
    alert('Level set to '+lvl);
    document.getElementById('levelMenu').style.display='none';
}
</script>
</body>
</html>
